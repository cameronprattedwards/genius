/*! genius 2014-04-09 */
var genius={};!function(){!function(){genius.utils={bind:function(a,b){var c=genius.utils.toArray(arguments).slice(1);if(Function.prototype.bind)return Function.prototype.bind.apply(a,c);if("function"!=typeof a)throw new TypeError("genius.utils.bind - what is trying to be bound is not callable");var d=Array.prototype.slice.call(arguments,1),e=a,f=function(){},g=function(){return e.apply(a instanceof f&&b?a:b,d.concat(c))};return f.prototype=this.prototype,g.prototype=new f,g},cascadingGet:function(a,b){for(var c=0;c<b.length;c++)if(b[c]&&b[c].hasOwnProperty(a)){var d=b[c][a];return!genius.utils.isNullOrUndefined(d)&&d.isAccessor?d():d}},cases:{camelObject:function(a){var b={};for(var c in a){var d=a[c];b[genius.utils.cases.pascalToCamel(c)]="object"==typeof d?genius.utils.cases.camelObject(d):d}return b},isCapitalized:function(a){return/[A-Z]/.test(a.charAt(0))},pascalToCamel:function(a){return a.charAt(0).toLowerCase()+a.substr(1)}},trim:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},except:function(a,b){var c={};for(var d in a)genius.utils.contains(b,d)||(c[d]=a[d]);return c},random:function(a,b){return Math.random()*(b-a)+a},map:function(a,b){var c=[];if(a)for(var d=0;d<a.length;d++)c[d]=b.call(this,a[d]);return c},isNullOrUndefined:function(a){return"undefined"==typeof a||"object"==typeof a&&!a},trace:function(a){for(var b=arguments.callee.caller,c=0;a>c;c++)b=b.arguments.callee.caller;console.log(b.toString())},partial:function(a){return function(){return a.apply(this,genius.utils.toArray(arguments).slice(1))}},toArray:function(a){var b=[];return Array.prototype.push.apply(b,a),b},accessor:function(a){var b=function(){return arguments.length&&(a=arguments[0]),a};return b.isAccessor=!0,b},extend:function(a,b){for(var c in b)a[c]=b[c];return a},contains:function(a,b){return-1!==genius.utils.indexOf(a,b)},indexOf:function(a,b){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},once:function(a){var b,c=!1,d=function(){return c||(c=!0,b=a.apply(this,arguments)),b};return d}}}(),function(){function a(){this.ajax={transformToCamelCase:genius.utils.accessor(!1),parseJson:genius.utils.accessor(function(a){return genius.config.ajax.parseJs().call(this,JSON.parse(a))}),parseJs:genius.utils.accessor(function(a){return a}),reset:function(){this.transformToCamelCase(!1),this.parseJson(function(a){return genius.config.ajax.parseJs().call(this,JSON.parse(a))}),this.parseJs(function(a){return a})}}}a.prototype={reset:function(a){this.types.reset(a),this.ajax.reset(a)}},genius.config=new a}(),function(){function a(a,b,c){this.singleton=function(){c[a]=genius.utils.once(b)},this.service=function(){},this.value=b}function b(a){this.service=function(){return a.value=a,a},this.singleton=function(){var b=genius.utils.once(a);return b.value=b,b},this.value=a}function c(){}function d(){this.kernel=new e(this),this.modules=new c;this.kernel.add(this.modules.realDataModule)}function e(a){var c=[];this.add=function(b){if(!genius.utils.contains(c,b))for(var e in b)genius.utils.contains(d.reservedKeywords,e)||(a[e]=b[e].value)},this.dependency=function(a){return new b(a)},this.wipe=function(b){for(var c in b)genius.utils.contains(d.reservedKeywords,c)||a[c]!=b[c].value||delete a[c]},this.reset=function(){this.wipe()}}Object.reservedKeywords=function(){var a={},b=[];for(var c in a)b.push(c);return b}(),c.prototype={register:function(a,b){this[a]=b}},c.reservedKeywords=["register"].concat(Object.reservedKeywords),d.prototype={set:function(b,c){return this[b]=c,new a(b,c,this)}},d.reservedKeywords=["kernel","modules","RouteProvider"].concat(Object.reservedKeywords),genius.box=new d}();var a={parse:function(a){return a},set:function(a,b){return b.value=a,b.isDirty=b.current!==b.value,b.value}},b={parse:function(a,b){return b.parseServerInput.call(this,a,b.constr)},set:function(a,b){return b.value=a,b.isDirty=!1,b.value}},c=a;!function(){function a(){this.boolean=new b(!1,!1),this.string=new b(!1,""),this.date=new b(!0,function(){return new Date},{parseServerInput:function(a){var b=/^\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}\.\d{3}Z$/;if("string"==typeof a&&b.test(a)){a=genius.utils.trim(a.replace(/[^\d]/g," "));var c=genius.utils.map(a.split(/\s+/),parseInt);return new Date(c[0],c[1]-1,c[2],c[3],c[4],c[5])}return a},toQuery:function(a){return a.toISOString()}}),this.collection=new b(!1,function(a){var b=genius.Collection.extend({type:a.genericType});return new b},{parseServerInput:function(a,b){return b.fromJs(a)}}),this.number=new b(!1,0),this.dynamic=new b(!0,null),this.custom=new b(!0,null,{parseServerInput:function(a,b){var c=new b;for(var d in a)c[d]?c[d].backdoor?c[d].backdoor(a[d]):c[d].isAccessor?c[d](a[d]):"function"!=typeof c[d]&&(c[d]=a[d]):c[d]=genius.types.dynamic().getInstance().initialize(a[d]).accessor();return c}})}function b(a,b,c){c=c||{},this.nullable=genius.utils.accessor(a),this.defaultTo=genius.utils.accessor(b),this.parseServerInput=genius.utils.accessor(c.parseServerInput||k),this.toQuery=genius.utils.accessor(c.toQuery||l),this.toJs=genius.utils.accessor(c.toJs||l),this.toJson=genius.utils.accessor(c.toJson||l);var d=[this.nullable(),this.defaultTo(),this.parseServerInput(),this.toQuery(),this.toJs(),this.toJson()];this.reset=function(){this.nullable(d[0]),this.defaultTo(d[1]),this.parseServerInput(d[2]),this.toQuery(d[3]),this.toJs(d[4]),this.toJson(d[5])}}function d(a,b,c,d){a=a||{},c=c||"custom";var e=genius.config.types[c];this.nullable=genius.utils.cascadingGet("nullable",[a,e]),"undefined"==typeof this.nullable&&(this.nullable=!0);var f=genius.utils.cascadingGet("defaultTo",[a,e]);this.defaultTo="function"==typeof f?f:function(){return f},this.parseServerInput=genius.utils.cascadingGet("parseServerInput",[a,e]),this.typeName=c,this.constr=b,this.toQuery=a.toQuery||e.toQuery,this.initialize=a.initialize||function(){return k},this.filter=d,this.value=this.defaultTo,this.genericType=a.type}function e(a,b,c,e){a=new d(a,b,c,e),a.filter(a.defaultTo(a),a,!0),this.getInstance=function(){return new g(genius.utils.extend({},a))},this.nullable=function(){return a.nullable},this.getDefault=a.defaultTo,this.constr=function(){return a.constr}}function f(a){a.filter(a.value,a),a.isDirty=!1,a.current=a.value,a.changeCallbacks={};var b=function(){if(arguments.length&&(arguments[0]=c.parse(arguments[0],a),a.filter(arguments[0],a),c.set(arguments[0],a),a.current!==a.value)){for(var b in a.changeCallbacks)a.changeCallbacks[b].call(this,a.current,a.value);a.current=a.value}return a.value},d=0;return genius.utils.extend(b,{subscribe:function(b){return a.changeCallbacks[d]=b,d++},unsubscribe:function(b){delete a.changeCallbacks[b]},toQuery:function(){return a.toQuery().call(this,a.value)},isAccessor:!0,nullable:function(){return a.nullable},defaultTo:a.defaultTo,isDirty:function(){return a.isDirty}}),b}function g(a){var b=this;a.value=a.defaultTo(a),this.accessor=genius.utils.once(function(){return f(a)}),this.initialize=genius.utils.once(function(d){return d=c.parse(d,a),a.filter(d,a),a.value=a.current=d,b})}function h(a,b,c){if(typeof a!=b.typeName&&typeof a!=b.typeName&&(!b.nullable&&!c||!genius.utils.isNullOrUndefined(a)))throw new TypeError("Value must be of type "+b.typeName+(b.nullable?", null, or undefined":""))}function i(a,b,c){if(!(a instanceof b.constr||(b.nullable||c)&&genius.utils.isNullOrUndefined(a)))throw new TypeError("Value must be of custom type "+b.constr.name+(b.nullable?", null, or undefined":""))}function j(a,b,c){if(!c&&!b.nullable&&genius.utils.isNullOrUndefined(a))throw new TypeError("Dynamic value cannot be null or undefined")}a.permanentProperties=["bool","string","date","number","dynamic","custom","add","reset"],a.prototype={add:function(a,c,d){d=d||{};{var f=genius.utils.cases.pascalToCamel(a);this[f]=new b(!0,null,d)}genius.types[f]=function(){return new e(d,c,f,i)}},reset:function(b){var c=b&&b.hard;for(var d in this)c&&!genius.utils.contains(a.permanentProperties,d)?delete this[d]:this[d].reset&&this[d].reset();a.call(this)}};var k=function(a){return a},l=function(a){return a};genius.config.types=new a,genius.types=function(a,b){return new e(b,a,"custom",i)},genius.utils.extend(genius.types,{string:function(a){return new e(a,String,"string",h)},"boolean":function(a){return new e(a,Boolean,"boolean",h)},number:function(a){return new e(a,Number,"number",h)},date:function(a){return new e(a,Date,"date",i)},collection:function(a){return new e({type:a},genius.Collection,"collection",i)},dynamic:function(a){return new e(a,function(){},"dynamic",j)}})}(),function(){function d(){}var e,f={getKey:function(a,b){if(a=a||{},b.uniqKey){var c=f.drillDown.call(this,a,b.uniqKey);return c}},getUrl:function(){},buildPrototype:function(a,b){for(var c in b)"function"==typeof b[c]&&(a[c]=b[c]);a.url="function"==typeof b.url?b.url:function(){return b.url||""}},setVarTyping:function(a){for(var b in a)"uniqKey"!==b&&"url"!==b&&(this[b]=a[b])},populateVar:function(a,b,c){var d=genius.config.ajax.transformToCamelCase();if(d){if(genius.utils.cases.isCapitalized(a)){var e=genius.utils.cases.pascalToCamel(a);return f.populateVar.call(this,e,b),void(this[a]&&(this[a]=this[e]))}"object"==typeof b&&(b=genius.utils.cases.camelObject(b))}this[a]&&this[a].getInstance?(this[a]=this[a].getInstance().initialize(b).accessor(),this[a].subscribe(function(){c.isDirty=!0})):"function"==typeof b?this[a]=b:this[a]&&this[a].backdoor?this[a].backdoor(b):this[a]&&this[a].isAccessor?this[a](b):this[a]=genius.types.dynamic({nullable:!0}).getInstance().initialize(b).accessor()},populateVars:function(a,b){for(var c in a)f.populateVar.call(this,c,a[c],b);for(var c in this)if("function"==typeof this[c].getInstance&&(this[c]=this[c].getInstance().accessor(),this[c].subscribe(function(){b.isDirty=!0})),this[c].isAccessor&&this[c]()&&this[c]().backdoor){var d=this[c];this[c].backdoor=genius.utils.bind(function(){return this().backdoor.apply(this(),arguments)},d)}},drillDown:function(a,b){for(var c=b.split("."),d=a[c[0]],e=1;e<c.length;e++){if(!d[c[e]])return;d=d[c[e]].isAccessor?d[c[e]]():d[c[e]]}return d},getInnerConfig:function(a,b){return a?(a.optionsHash=b,a):{isDirty:!0,isNew:!0,isLoading:!1,isDeleted:!1,optionsHash:b}},initialize:function(a){var d={none:{}},e=0,f=function(a,b){return d[a]||(d[a]={}),d[a][e]=b,e++},g=function(a){var b;if(b=d[a])for(var c in b)b[c].apply(this,genius.utils.toArray(arguments).slice(1))};genius.utils.extend(this,{subscribe:function(a,b){switch(arguments.length){case 1:return f("none",a);case 2:return f(a,b)}},unsubscribe:function(a){var b=!1;for(var c in d)if(d[c][a]){b=!0,delete d[c][a];break}return b},isDirty:function(){return a.isDirty},isNew:function(){return a.isNew},isDeleted:function(){return a.isDeleted},isLoading:function(){return a.isLoading},optionsHash:function(){return a.optionsHash},$delete:function(){function b(){for(var a in this)this[a]&&this[a].isAccessor&&delete this[a]}if(g("delete"),a.isNew)b.call(this),a.isDeleted=!0;else{var c=genius.box.RouteProvider().createRoute(this.url(),this,!1),d=this;a.isLoading=!0,genius.box.HttpBackend().del(c).done(function(){a.isDeleted=!0,b.call(d)}).always(function(){a.isLoading=!1})}return null},$save:function(){if(a.isDeleted)throw new ReferenceError("You cannot save a deleted resource.");if(a.isDirty){var d=genius.box.RouteProvider(),e=d.createRoute(this.url(),this,!1),f=this;a.isLoading=!0,genius.box.HttpBackend()[a.isNew?"post":"put"](e,this.toJson()).done(function(d){d=genius.config.ajax.parseJson().call(this,d),c=b;for(var e in d)f[e]&&f[e].backdoor?(f[e].backdoor(d[e]),f[e].isDirty(!1)):f[e]&&f[e].isAccessor&&(f[e](d[e]),f[e].isDirty(!1));a.isDirty=a.isNew=!1}).always(function(){a.isLoading=!1})}}})}};d.fromJs=function(e){c=b;var f=new d(e);return c=a,f},d.prototype={changedProperties:function(){var a={};for(var b in this)this[b].isAccessor&&this[b].isDirty()&&(a[b]=this[b]());return a},properties:function(){var a={};for(var b in this)this[b].isAccessor&&(a[b]=this[b],a[b]()instanceof d&&(a[b]=a[b].properties()));return a},toJs:function(){var a={};for(var b in this)this[b].toJs?a[b]=this[b].toJs():this[b].isAccessor&&(a[b]=this[b](),a[b]instanceof d&&(a[b]=a[b].toJs()));return a},toJson:function(){return JSON.stringify(this.toJs())}},Object.defineProperty(d.prototype,"pojo",{get:function(){return this.toJs()}}),d.extend=function(d){function g(a){function b(){f.setVarTyping.call(this,d),f.populateVars.call(this,a,f.getInnerConfig(j,a));var b;if(b=f.getKey(a,d)){var c=i[b];if(c)return f.populateVars.call(c,a),c;i[b]=this}}return e?void 0:("function"==typeof this.init&&this.init.apply(this,arguments),f.initialize.call(this,f.getInnerConfig(j,a),a),b.prototype=this,new b)}if(d=d||{},d.uniqKey&&(field=d[d.uniqKey])){if(!field.nullable())throw new TypeError("Unique keys must be nullable");if(!genius.utils.isNullOrUndefined(field.getDefault()))throw new TypeError("Unique keys must default to undefined or null")}e=!0;var h=new this;e=!1,f.buildPrototype(h,d);var i={},j=null;return genius.utils.extend(g,{extend:arguments.callee,prototype:h,fromJs:function(d){c=b;var e=new this;return f.populateVars.call(e,d,j),c=a,e},$get:function(e){var g=genius.box.HttpBackend(),h=genius.box.RouteProvider().createRoute(this.prototype.url(),e);j={isNew:!1,isDirty:!1,isLoading:!0,isDeleted:!1};var i=j,k=new this(e);return j=null,k.$promise=g.get(h).done(function(e){var g=genius.config.ajax.parseJson().call(this,e);d.parseServerInput&&(g=d.parseServerInput(g)),c=b,f.populateVars.call(k,g,i),c=a,i.isDirty=!1}).always(function(){i.isLoading=!1}),k},$query:function(d){d=d||{};var e=genius.Collection.extend({type:genius.types(g)}),f=new e,h=genius.box.HttpBackend(),i=genius.box.RouteProvider().createRoute(this.prototype.url(),d);return f.$promise=h.get(i).done(function(d){var e=genius.config.ajax.parseJson().call(this,d);j={isNew:!1,isDirty:!1,isLoading:!1,isDeleted:!1},c=b,f.concat(e),c=a,j=null,f.isLoading(!1)}),f}}),g},genius.Resource=d}(),function(){function d(a){a=a||{},this.push=function(b){if(a.type&&(b=a.type.getInstance().initialize(b).accessor().call()),a.unique&&genius.utils.contains(this,b))return this.length;var c=a.unique&&genius.utils.contains(this,b)?this.length:Array.prototype.push.call(this,b);return c},this.addNew=function(){this.push(a.type?(constr=a.type.constr())?new constr:a.type.getInstance().accessor().call():{})},this.concat=function(b){return a.type&&(b=genius.utils.map(b,function(b){return a.type.getInstance().initialize(b).accessor().call()})),Array.prototype.push.apply(this,b)},this.removeAll=function(){this.splice(0)},this.remove=function(a){for(var b;-1!==(b=genius.utils.indexOf(this,a));)this.splice(b,1)}}d.prototype=[],d.fromJs=function(a){var b=new genius.Collection;return b.concat(a),b};var e=!1;d.extend=function(d){function f(a){if(!e){a=a||{},"function"==typeof this.init&&this.init.apply(this,arguments),a.type&&(h=a.type),a.unique&&(i=a.unique),this.isLoading=genius.utils.accessor(!0),this.type=function(){return h},this.isDirty=genius.utils.accessor(!1);var b={},c=0;this.subscribe=function(a){return b[c]=a,c++},this.backdoor=function(a){h&&(a=genius.utils.map(a,function(a){return h.getInstance().initialize(a).accessor().call()}));var b=[0,this.length];b.push.apply(b,a),this.splice.apply(this,b)},this.fire=function(){}}}d=d||{},e=!0;var g=new this;e=!1;var h=d.type,i=d.unique;g.toJs=function(){return genius.utils.map(this,function(a){return a.toJs?a.toJs():a}).slice(0,this.length)},g.initialize=function(a){return markDirty=!1,this.concat(a),markDirty=!0,this},g.accessor=function(){var a=this,b=function(){return arguments.length&&(a.removeAll(),a.concat(arguments[0]),a.isDirty(!0)),a};return b.isAccessor=!0,b.subscribe=this.subscribe,b.isDirty=this.isDirty,b.toJs=this.toJs.bind(this),b},g.addNew=function(){this.push(h?(constr=h.constr())?new constr:h.getInstance().accessor().call():{})},g.push=function(a){if(h&&(a=h.getInstance().initialize(a).accessor().call()),i&&genius.utils.contains(this,a))return this.length;if(a instanceof genius.Resource){var b=this;a.subscribe("delete",function(){b.remove(a)})}var c=i&&genius.utils.contains(this,a)?this.length:Array.prototype.push.call(this,a);return c},(concat=Array.prototype.concat)&&(g.concat=function(a){return h&&(a=genius.utils.map(a,function(a){if(a=h.getInstance().initialize(a).accessor().call(),a instanceof genius.Resource){var b=this;a.subscribe("delete",function(){b.remove(a)})}return a})),Array.prototype.push.apply(this,a)});for(var j in d)"function"==typeof d[j]&&"type"!==j&&(g[j]=d[j]);return f.fromJs=function(d){var e=new f;c=b;genius.utils.map(d,function(a){return h.getInstance().initialize(a).accessor().call()});return e.concat(d),c=a,e},f.prototype=g,f.extend=arguments.callee,f},genius.Collection=d}(),function(){function a(){function a(){this.done=function(a){if("function"==typeof a){if("resolved"==f)return a.apply(this,arguments),this;c.push(a)}return this},this.fail=function(a){if("function"==typeof a){if("rejected"==f)return a.apply(this,arguments),this;d.push(a)}return this},this.always=function(a){if("function"==typeof a){if("pending"!==f)return a.apply(this,arguments),this;e.push(a)}return this},this.state=function(){return f}}function b(a,b){for(var c=0;c<a.length;c++)a[c].apply(this,b);for(var c=0;c<e.length;c++)e[c].apply(this,b)}var c=[],d=[],e=[],f="pending";this.resolve=function(){f="resolved",b.call(this,c,arguments)},this.reject=function(){f="rejected",b.call(this,d,arguments)};var g=new a;this.promise=function(){return g}}a.prototype={done:function(){return this.promise().done.apply(this,arguments)},fail:function(){return this.promise().fail.apply(this,arguments)},always:function(){return this.promise().always.apply(this,arguments)}},genius.deferred=function(){return new a}}(),function(){function a(a,b,c){this.toReturn=function(d){a.expectations[b+"-"+c]=d}}function b(){this.expectations={},this.pendingRequests={}}b.prototype=function(){function b(a,b){if(!this.expectations[a+"-"+b])throw new ReferenceError("Unexpected request for "+b);var c=genius.deferred();return this.pendingRequests[a+"-"+b]=c,c.promise()}return{get:function(a){return b.call(this,"get",a)},put:function(a){return b.call(this,"put",a)},post:function(a){return b.call(this,"post",a)},flush:function(){for(var a in this.pendingRequests)this.pendingRequests[a].resolve(this.expectations[a]),delete this.pendingRequests[a]},expectGet:function(b){return new a(this,"get",b)},expectPost:function(b){return new a(this,"post",b)},expectPut:function(b){return new a(this,"put",b)},expectDelete:function(b){return new a(this,"delete",b)}}}(),genius.box.set("FakeHttpBackend",function(){return new b}).singleton()}(),function(){function a(){}function b(a,b,c){var d=genius.deferred(),e=genius.box.XHR();return e.open(b,a,!0),e.setRequestHeader("Accepts","application/json"),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&d.resolve(e.responseText)},e.send(c),d.promise()}a.prototype={get:function(a){return b(a,"GET")},put:function(a,c){return b(a,"PUT",c)},post:function(a,c){return b(a,"POST",c)},del:function(a,c){return b(a,"DELETE",c)}},genius.box.set("RealHttpBackend",function(){return new a})}(),function(){function a(a){var b=!1,c=this,d=function(){a.call().always(function(){b&&setTimeout(d,c.buffer())})};this.start=function(){b||(b=!0,d())},this.stop=function(){b=!1},this.buffer=genius.utils.accessor(0)}genius.box.set("AsyncQueue",function(){return new a}).service()}(),function(){function a(a){var b=[];for(var c in a)a[c]&&b.push(c+"="+(a[c].toQuery?a[c].toQuery():a[c]));return b.length?"?"+b.join("&"):""}function b(){}b.prototype={createRoute:function(b,c,d){for(var e,f=/\:([^\/\.\-]+)/gi,g=b,h=[];e=f.exec(b);){var i,j=e[1];i=c[j]?c[j].isAccessor&&c[j]()?c[j]():"function"!=typeof c[j]?c[j]:"":"",g=g.replace(e[0],i),h.push(e[1])}for(;/\/$/.test(g);)g=g.substr(0,g.length-1);return d!==!1&&(g+=a(genius.utils.except(c instanceof genius.Resource?c.properties():c,h))),g}},genius.box.set("RouteProvider",function(){return new b}).singleton()}(),function(){window.XMLHttpRequest?genius.box.set("XHR",function(){return new XMLHttpRequest}):window.ActiveXObject&&genius.box.set("XHR",function(){return new ActiveXObject("Microsoft.XMLHTTP")})}(),function(){genius.box.modules.register("realDataModule",{HttpBackend:genius.box.kernel.dependency(genius.box.RealHttpBackend)}),genius.box.modules.register("testDataModule",{HttpBackend:genius.box.kernel.dependency(genius.box.FakeHttpBackend)}),genius.box.kernel.add(genius.box.modules.realDataModule)}()}();